# Localization Implementation

## Overview

The application uses [Paraglide JS](https://inlang.com/m/gerre34r) for internationalization (i18n) with support for English (en) and Thai (th) languages.

## Architecture

### Core Components

- **Message Files**: Located in `/messages/` directory
  - `en.json` - English translations
  - `th.json` - Thai translations

- **Generated Files**: Auto-generated by Paraglide in `/src/lib/paraglide/`
  - `messages.js` - Message functions export
  - `runtime.js` - Locale management utilities
  - `server.js` - Server-side middleware

### Configuration

- **Project Settings**: `project.inlang/settings.json`
  - Base locale: `en`
  - Supported locales: `["en", "th"]`
  - Message pattern: `./messages/{locale}.json`

## Implementation Details

### Middleware Setup

Server-side locale detection is handled in `src/hooks.server.ts`:

```typescript
import { paraglideMiddleware } from '$lib/paraglide/server';

const handleParaglide: Handle = ({ event, resolve }) =>
  paraglideMiddleware(event.request, ({ request, locale }) => {
    event.request = request;
    return resolve(event, {
      transformPageChunk: ({ html }) => html.replace('%paraglide.lang%', locale)
    });
  });
```

### Locale Detection Strategy

The application uses the following strategy for locale detection:
1. Cookie-based persistence
2. Global variable fallback  
3. Base locale default (en)

### Usage in Components

Import messages and use bracket notation for nested keys:

```svelte
<script>
  import * as m from '$lib/paraglide/messages';
</script>

<h1>{m['navigation.home']()}</h1>
<p>{m['user.balance']()}: {balance}</p>
```

### Language Switcher

A language switcher component is available in the sidebar header:
- Location: `src/lib/components/self/language-switcher.svelte`
- Uses dropdown menu for locale selection
- Persists selection via cookies

## Message Structure

Messages are organized hierarchically:

```json
{
  "navigation": {
    "home": "Home",
    "games": "Games",
    "dice": "Dice",
    "flip": "Flip"
  },
  "user": {
    "signIn": "Sign In",
    "logOut": "Log out",
    "balance": "Balance"
  },
  "game": {
    "betAmount": "Bet Amount",
    "profit": "Profit",
    "letsGoGambling": "Let's go gambling"
  },
  "common": {
    "loading": "Loading...",
    "language": "Language",
    "save": "Save"
  }
}
```

## Development Workflow

### Adding New Messages

1. Add messages to both `messages/en.json` and `messages/th.json`
2. Compile messages: `npx @inlang/paraglide-js compile --project ./project.inlang --outdir ./src/lib/paraglide`
3. Use in components with bracket notation: `m['category.key']()`

### Translation Guidelines

- **English**: Use clear, concise language
- **Thai**: Provide culturally appropriate translations
- **Consistency**: Maintain consistent terminology across the application
- **Context**: Consider UI context when translating (buttons vs. labels)

## File Locations

```
├── messages/
│   ├── en.json          # English translations
│   └── th.json          # Thai translations
├── project.inlang/
│   └── settings.json    # Paraglide configuration
├── src/lib/paraglide/   # Generated files (do not edit)
│   ├── messages.js
│   ├── runtime.js
│   └── server.js
└── src/lib/components/self/
    └── language-switcher.svelte  # Language selection UI
```

## Supported Features

- ✅ Server-side rendering (SSR) support
- ✅ Client-side locale switching
- ✅ Cookie-based persistence
- ✅ Nested message structure
- ✅ Type-safe message functions
- ✅ Hot reload during development

## Browser Support

The localization system works with:
- Modern browsers supporting ES6+
- Server-side rendering environments
- Static site generation (SSG)

## Troubleshooting

### Common Issues

1. **Function not found errors**: Ensure messages are compiled after changes
2. **Locale not persisting**: Check cookie settings and middleware setup
3. **Missing translations**: Verify both language files have matching keys

### Debug Tools

- Check browser cookies for `PARAGLIDE_LOCALE`
- Inspect generated files in `/src/lib/paraglide/`
- Use browser dev tools to monitor locale changes
